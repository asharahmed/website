# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Overview

Static portfolio and status portal for asharahmed.com. No build pipeline or bundler - edit files directly. Served by Nginx from `/var/www/html`. See AGENTS.md for detailed server setup, CI/CD workflow, and operational runbooks.

## Commands

```bash
# Install dependencies and git hooks
npm install
npm run hooks:install

# Install Playwright browsers (required for E2E tests)
npm run deps:playwright

# Quick validation (lint + link check)
npm run verify:quick

# Full test suite (lint + links + Playwright E2E)
npm run test

# Individual linting
npm run lint:html
npm run lint:css
npm run lint:vibe

# Local development server
python3 -m http.server 8080

# Deploy (from main branch only)
./scripts/deploy.sh

# Skip hooks temporarily
SKIP_HOOKS=1 git commit ...
SKIP_E2E=1 git push ...
```

**Git Hooks** (installed via `npm run hooks:install`):
- Pre-commit: `lint:html`, `lint:css`, `lint:vibe`, `test:links`
- Pre-push: `test:e2e` (auto-skips if Playwright deps missing)

## Architecture

**Tech Stack:** Vanilla JS, CSS3 with custom properties, HTML5. No frameworks.

**Key Files:**
- `index.html` - Single-page portfolio with anchor-linked sections
- `main.js` - Home page: theme toggle, command palette (Cmd/Ctrl+K), mobile menu, typing animation, IntersectionObserver animations
- `particles.js` - Particle system for hero section with spatial grid partitioning, adaptive quality
- `shared.js` - Global behaviors: page transitions, link prefetch, environment detection
- `shared.css` / `styles.css` - Global and home page styles with light/dark theme support

**Environment Detection:** `shared.js` adds `is-prod` class on asharahmed.com, which hides the beta banner and adjusts sticky offsets.

**Particle System Performance:** Skips on ≤4GB RAM, Save-Data header, or `prefers-reduced-motion`. Quality adapts based on FPS monitoring.

**Status Portal (`/status/`):**
- `status/index.html`, `status/status.js`, `status/status.css`
- Polls `/status/metrics.json` every 5 seconds
- Displays: CPU, RAM, disk usage (ring gauge), disk I/O (sparkline), service health
- Metrics generated by systemd timer running `/usr/local/bin/status-metrics.sh` every 10 seconds

**Module Pattern:** All JS uses IIFEs. DOM utilities: `qs(sel)` / `qsa(sel)` for querySelector/querySelectorAll.

## Deployment

- `main` branch → production (asharahmed.com), then attempts merge to beta
- `beta` branch → beta only (beta.aahmed.ca)
- GitHub Actions: lint → test → rsync to server → health check
- Docs-only changes skip deployment (README.md, AGENTS.md, etc.)

## Editing Guidelines

**Commit messages** must include a `Changelog:` footer:
```
fix: correct mobile menu z-index

Changelog:
- Fix mobile menu appearing behind hero section
- Adjust z-index stacking context
```

- **ASCII by default:** Only use Unicode when necessary and already present
- **Minimal changes:** Surgical edits, avoid rewriting large blocks
- **Theme aware:** Test both light and dark modes for nav/banner CSS changes
- **No new dependencies** without explicit request

## Accessibility & Security

- External links: `rel="noopener noreferrer"` with `target="_blank"`
- JS `window.open`: include `noopener`, set `win.opener = null`
- Maintain `aria-*` attributes on interactive elements (command palette, mobile menu)
- Keep `:focus-visible` styles for keyboard users
- Respect `prefers-reduced-motion` for animations

## Quick Reference

| Path | Purpose |
|------|---------|
| `/var/www/html` | Document root on server |
| `ops/` | Server setup scripts, systemd units, nginx config |
| `scripts/` | CI, deploy, health checks, screenshots |
| `tests/smoke.spec.js` | Playwright E2E tests |

## Troubleshooting

| Issue | Fix |
|-------|-----|
| Playwright tests fail locally | Run `npm run deps:playwright` to install browsers |
| Metrics missing on status page | Check `systemctl status status-metrics.timer` on server |
| Theme toggle not persisting | Verify localStorage is available |
| Particles not rendering | Check device memory, motion preferences, canvas support |
